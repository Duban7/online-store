<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
    <style>
        .products{
            display: flex;
            align-items: flex-start;
        }
        .Prod{
            border: solid;
            border-width: 2px;
            border-color: black;
            border-radius: 10px;
            width:fit-content;
            height: fit-content;
            margin: 10px;
        }
        .prodImg{
            width: 200px;
            height: 200px;
            margin: 1px;
            border: solid;
            border-radius: 10px;
        }
    </style>
</head>
<body>

    <div class="products"></div>
    <div class="categories"></div>
    <div class="subcategories"></div>
    <input type=button value="Показать все товары" onClick="GetProducts();">
    <input type=button value="Показать  товар" onClick="GetProduct();">
    <input type=button value="Показать  категории" onClick="GetCategories();">
    <input type=button value="Показать  субкатегории" onClick="GetSubcategories();">

    <script>

        async function GetProducts() {
            const response = await fetch("/products", {
                method: "GET",
                headers: { "Accept": "application/json" }
            });
            if (response.ok === true) {
                const products = await response.json();
                const divProducts = document.getElementsByClassName('products')[0];
                products.forEach(async (element) => {
                    console.log(element);
                    divProducts.append(await addProduct(element));
                });
            }
        }

        async function GetProduct() {
            const response = await fetch("/products/637a7d0f64ba672b1c3ba1fe", {
                method: "GET",
                headers: { "Accept": "application/json" }
            });
            if (response.ok === true) {
                const product = await response.json();
                const divProduct = document.getElementsByClassName('products')[0];
                divProduct.append(await addProduct(product));
            }
        }

        async function GetCategories() {
            const response = await fetch("/products/category", {
                method: "GET",
                headers: { "Accept": "application/json" }
            });
            if (response.ok === true) {
                const categories = await response.json();
                const divCategories = document.getElementsByClassName('categories')[0];
                categories.forEach(async (element) => {
                    console.log(element);
                    divCategories.append(await addCategory(element));
                    divCategories.append(document.createElement("br"));
                });
            }
        }

        async function GetSubcategories() {
            const response = await fetch("/products/Electronics/subcategory", {
                method: "GET",
                headers: { "Accept": "application/json" }
            });
            if (response.ok === true) {
                const subcategories = await response.json();
                const divSubcategories = document.getElementsByClassName('subcategories')[0];
                subcategories.forEach(async (element) => {
                    console.log(element);
                    divSubcategories.append(await addSubcategory(element));
                    divSubcategories.append(document.createElement("br"));
                });
            }
        }

        async function addProduct(product) {
            const div = document.createElement('div');
            div.className = "Prod";

            const prodName = document.createElement('h1');
            prodName.append(product.name);
            div.append(prodName);

            const img = document.createElement('img');
            img.className = 'prodImg';
            const responce = await fetch("/products/" + product.id + "/image", {
                method: "GET",
                headers: { "Accept": "image/png" }
            });
            if (responce.ok === true) {
                const ResBlob = await responce.blob();
                img.src = URL.createObjectURL(ResBlob);
            }
            else {
                console.error("грустно");
            }
            div.append(img);

            const prodPrice = document.createElement('h2');
            prodPrice.append('price: ' + product.price);
            div.append(prodPrice);

            return div;
        }

        async function addCategory(category) {

            const cat = document.createElement('label');
            cat.append(category.name);

            return cat;
        }

        async function addSubcategory(subcategory) {

            const subcat = document.createElement('label');
            subcat.append(subcategory.name);

            return subcat;
        }

    </script>

</body>
</html>